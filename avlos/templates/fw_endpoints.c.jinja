/*
* This file was automatically generated using Avlos.
* https://github.com/tinymovr/avlos
*
* Any changes to this file will be overwritten when
* content is regenerated.
*/

{%- for include in includes %}
#include {{ include | as_include }}
{%- endfor %}

{% set comma = joiner(", ") %}
uint8_t (*avlos_endpoints[{{ instance | endpoints | length }}])(uint8_t * buffer, uint8_t * buffer_len, Avlos_Command cmd) = { {%- for attr in instance | endpoints %}{{ comma() }}&{{attr.name}}_{{attr.ep_id}}{%- endfor %} };
uint32_t avlos_proto_hash = {{ instance.hash_uint32 }};

{%- for attr in instance | endpoints %}

uint8_t {{attr.name}}_{{attr.ep_id}}(uint8_t * buffer, uint8_t * buffer_len, Avlos_Command cmd)
{
    {{attr.dtype.c_name}} v;

    {%- if attr.c_getter %}
    if (AVLOS_CMD_READ == cmd) {
        v = {{ attr.c_getter }}();
        *buffer_len = sizeof(v);
        memcpy(buffer, &v, sizeof(v));
        return AVLOS_RET_READ;
    }
    {%- endif %}
    {%- if attr.c_setter %}
    {% if attr.c_getter %}else {% endif %}if (AVLOS_CMD_WRITE == cmd) {
        memcpy(&v, buffer, sizeof(v));
        {{ attr.c_setter }}(v);
        return AVLOS_RET_WRITE;
    }
    {%- endif %}
    {%- if attr.c_caller %}

        uint8_t offset = 0;
        {%- for arg in attr.arguments %}
        {{ arg.dtype.c_name }} {{arg.name}};
        memcpy(&{{arg.name}}, buffer+offset, sizeof({{arg.name}}));
        offset += sizeof({{arg.name}});
        {%- endfor %}

        {% set comma = joiner(", ") %}
        {%- if attr.return_type %}
        {{attr.return_type.c_name}} ret_val = {{ attr.c_caller }}({%- for arg in attr.arguments %}{{ comma() }}{{ arg.name }} {%- endfor %});
        memcpy(buffer, &v, sizeof(v));
        {%- else %}
        {{ attr.c_caller }}({%- for arg in attr.arguments %}{{ comma() }}{{ arg.name }} {%- endfor %});
        {%- endif %}
        
        return AVLOS_RET_CALL;
    {%- endif %}
    return AVLOS_RET_NOACTION;
}

{%- endfor %}
